import express from 'express';
import { Request, Response } from 'express';
import nodemailer from 'nodemailer';
import FranchiseApplication from '../../models/Franchise/FranchiseApplications';
import { authenticateToken } from '../../middleware/auth';

const router = express.Router();

// Configure nodemailer
const transporter = nodemailer.createTransport({
  host: process.env.EMAIL_HOST,
  port: Number(process.env.EMAIL_PORT),
  secure: true,
  auth: {
    user: process.env.EMAIL_USER,
    pass: process.env.EMAIL_PASS
  }
});

// Submit new franchise application (Public route)
router.post('/apply', async (req: Request, res: Response) => {
  try {
    // Verify reCAPTCHA token
    const recaptchaToken = req.body?.recaptchaToken;
    const secret = process.env.RECAPTCHA_SECRET;

    if (!recaptchaToken) {
      return res.status(400).json({ success: false, message: 'reCAPTCHA token missing' });
    }

    if (!secret) {
      console.warn('RECAPTCHA_SECRET is not set in environment; skipping verification (not recommended)');
    } else {
      const params = new URLSearchParams();
      params.append('secret', secret);
      params.append('response', recaptchaToken);
      params.append('remoteip', req.ip || '');

      let fetchFn: typeof fetch | undefined = (globalThis as any).fetch;
      if (!fetchFn) {
        try {
          const nodeFetch = await import('node' + '-fetch').then(m => m as any);
          fetchFn = nodeFetch.default || nodeFetch;
        } catch (err) {
          console.warn('node-fetch not installed or failed to import; fetch may be unavailable for reCAPTCHA verification', err);
        }
      }

      if (!fetchFn) {
        console.error('No fetch available on server for reCAPTCHA verification. Install node-fetch or run on Node 18+');
        return res.status(500).json({ success: false, message: 'Server fetch not available for reCAPTCHA verification' });
      }

      const verifyRes = await fetchFn('https://www.google.com/recaptcha/api/siteverify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: params.toString(),
      });

      if (!verifyRes.ok) {
        console.error('reCAPTCHA siteverify HTTP error', { status: verifyRes.status, statusText: verifyRes.statusText });
      }

      type RecaptchaVerifyResponse = {
        success?: boolean;
        'challenge_ts'?: string;
        hostname?: string;
        'error-codes'?: string[];
        [key: string]: any;
      };

      const verifyJson = (await verifyRes.json()) as RecaptchaVerifyResponse;

      if (!verifyJson || typeof verifyJson !== 'object' || verifyJson.success !== true) {
        console.error('reCAPTCHA verification failed', verifyJson);
        return res.status(400).json({ success: false, message: 'reCAPTCHA verification failed', details: verifyJson });
      }
    }

    const { recaptchaToken: _rc, ...applicationData } = req.body;
    const application = new FranchiseApplication(applicationData);
    await application.save();

    // Send confirmation email to applicant
    if (applicationData.email) {
      try {
        console.log('Sending franchise application confirmation email to:', applicationData.email);
        
        await transporter.sendMail({
          from: process.env.EMAIL_USER,
          to: applicationData.email,
          subject: 'Franchise Application Received - BharatMart',
          html: `
            <!DOCTYPE html>
            <html>
            <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <style>
                body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
                .container { max-width: 600px; margin: 0 auto; background-color: #ffffff; }
                .header { background: linear-gradient(135deg, #f97316 0%, #10b981 100%); padding: 30px 20px; text-align: center; }
                .logo { max-width: 200px; height: auto; }
                .content { padding: 40px 30px; }
                .greeting { font-size: 24px; color: #1f2937; margin-bottom: 20px; font-weight: 600; }
                .message { font-size: 16px; color: #4b5563; line-height: 1.6; margin-bottom: 20px; }
                .highlight-box { background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 20px; margin: 30px 0; border-radius: 4px; }
                .highlight-box p { margin: 0; color: #92400e; font-size: 15px; line-height: 1.5; }
                .info-box { background-color: #f3f4f6; padding: 25px; border-radius: 8px; margin: 25px 0; }
                .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb; }
                .info-row:last-child { border-bottom: none; }
                .info-label { font-weight: 600; color: #374151; }
                .info-value { color: #6b7280; }
                .next-steps { background-color: #eff6ff; padding: 25px; border-radius: 8px; margin: 25px 0; }
                .next-steps h3 { color: #1e40af; margin-top: 0; margin-bottom: 15px; font-size: 18px; }
                .next-steps ul { margin: 0; padding-left: 20px; color: #1e40af; }
                .next-steps li { margin-bottom: 10px; line-height: 1.5; }
                .contact-box { background-color: #f0fdf4; padding: 20px; border-radius: 8px; margin: 25px 0; text-align: center; }
                .contact-box h3 { color: #166534; margin-top: 0; margin-bottom: 15px; }
                .contact-info { color: #166534; font-size: 15px; line-height: 1.8; }
                .footer { background-color: #f9fafb; padding: 30px 20px; text-align: center; border-top: 1px solid #e5e7eb; }
                .footer p { margin: 5px 0; color: #6b7280; font-size: 14px; }
                .social-links { margin: 20px 0; }
                .social-links a { display: inline-block; margin: 0 10px; color: #f97316; text-decoration: none; }
              </style>
            </head>
            <body>
              <div class="container">
                <!-- Header with Logo -->
                <div class="header">
                  <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAABkCAYAAABwx8J9AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEsWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA3LTI4PC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmM5MDQzMjBmLTc1MTctNGMwNy04NjM5LTcwMTM5ODhkYTllODwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz5yZWdhbGZpbnRlY2hfbG9nbyAtIDQ8L3JkZjpsaT4KICAgPC9yZGY6QWx0PgogIDwvZGM6dGl0bGU+CiA8L3JkZjpEZXNjcmlwdGlvbj4KCiA8cmRmOkRlc2NyaXB0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" alt="BharatMart Logo" class="logo">
                </div>

                <!-- Main Content -->
                <div class="content">
                  <h2 class="greeting">Dear ${applicationData.fullName || 'Applicant'},</h2>
                  
                  <p class="message">
                    Thank you for your interest in becoming a <strong>BharatMart</strong> franchise partner! 
                    We are excited to inform you that we have successfully received your franchise application.
                  </p>

                  <div class="highlight-box">
                    <p><strong>‚úì Application Submitted Successfully</strong></p>
                    <p style="margin-top: 10px;">Your application has been registered in our system and is now under review by our franchise team.</p>
                  </div>

                  <!-- Application Details -->
                  <div class="info-box">
                    <h3 style="margin-top: 0; color: #1f2937; font-size: 18px;">Application Details</h3>
                    <div class="info-row">
                      <span class="info-label">Application ID:</span>
                      <span class="info-value">${application._id}</span>
                    </div>
                    <div class="info-row">
                      <span class="info-label">Submitted On:</span>
                      <span class="info-value">${new Date().toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric' })}</span>
                    </div>
                    <div class="info-row">
                      <span class="info-label">Preferred City:</span>
                      <span class="info-value">${applicationData.city || 'N/A'}</span>
                    </div>
                    <div class="info-row">
                      <span class="info-label">Investment Range:</span>
                      <span class="info-value">${applicationData.investmentCapacity || 'N/A'}</span>
                    </div>
                  </div>

                  <!-- Next Steps -->
                  <div class="next-steps">
                    <h3>üìã What Happens Next?</h3>
                    <ul>
                      <li><strong>Review Process:</strong> Our team will carefully review your application within 1-2 business days</li>
                      <li><strong>Initial Assessment:</strong> We'll evaluate your profile and franchise requirements</li>
                      <li><strong>Contact:</strong> A franchise consultant will reach out to you via email or phone</li>
                      <li><strong>Discussion:</strong> We'll schedule a detailed discussion about the franchise opportunity</li>
                      <li><strong>Documentation:</strong> If approved, we'll guide you through the next steps and documentation</li>
                    </ul>
                  </div>

                  <p class="message">
                    Please keep this email for your records. You may be asked to reference your <strong>Application ID</strong> 
                    in future communications.
                  </p>

                  <!-- Contact Information -->
                  <div class="contact-box">
                    <h3>Need Assistance?</h3>
                    <div class="contact-info">
                      <p><strong>üìß Email:</strong> franchise@bharatmart.app</p>
                      <p><strong>üìû Phone:</strong> +91 70032 60281 | +91 84202 39501</p>
                      <p><strong>üïê Business Hours:</strong> Mon-Sat, 9:00 AM - 7:00 PM IST</p>
                    </div>
                  </div>

                  <p class="message" style="margin-top: 30px;">
                    We appreciate your patience during the review process. Our team is committed to finding the right 
                    franchise partners who share our vision of bringing quality products to communities across India.
                  </p>

                  <p class="message" style="margin-top: 20px;">
                    <strong>Thank you for choosing BharatMart!</strong>
                  </p>
                </div>

                <!-- Footer -->
                <div class="footer">
                  <p style="font-weight: 600; color: #1f2937; margin-bottom: 15px;">BharatMart - Empowering Local Communities</p>
                  <p>4th Floor, "Bells House", 10A Ho Chi Minh Sarani</p>
                  <p>Kolkata - 700071, West Bengal, India</p>
                  
                  <div class="social-links">
                    <a href="https://bharatmart.app">üåê Website</a>
                    <a href="mailto:info@bharatmart.app">‚úâÔ∏è Email</a>
                  </div>
                  
                  <p style="font-size: 12px; color: #9ca3af; margin-top: 20px;">
                    This is an automated email. Please do not reply directly to this message.
                  </p>
                  <p style="font-size: 12px; color: #9ca3af;">
                    ¬© ${new Date().getFullYear()} BharatMart. All rights reserved.
                  </p>
                </div>
              </div>
            </body>
            </html>
          `
        });

        console.log('Franchise application confirmation email sent successfully to:', applicationData.email);
      } catch (emailError) {
        console.error('Failed to send confirmation email:', emailError);
        // Continue with the response even if email fails
      }
    }

    res.status(201).json({
      success: true,
      message: 'Application submitted successfully',
      applicationId: application._id,
    });
  } catch (error) {
    console.error('Franchise application submission error:', error);
    res.status(400).json({
      success: false,
      message: 'Failed to submit application',
      error: error instanceof Error ? error.message : 'Unknown error occurred',
    });
  }
});

// The following routes should be protected with authentication

// Get all applications (Admin only)
router.get('/all', authenticateToken, async (req: Request, res: Response) => {
  try {
    const applications = await FranchiseApplication.find()
      .sort({ submittedAt: -1 }); // Most recent first
    
    res.json({
      success: true,
      applications
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'Failed to fetch applications',
      error: error instanceof Error ? error.message : 'Unknown error occurred'
    });
  }
});

// Get application by ID (Admin only)
router.get('/:id', authenticateToken, async (req: Request, res: Response) => {
  try {
    const application = await FranchiseApplication.findById(req.params.id);
    if (!application) {
      return res.status(404).json({
        success: false,
        message: 'Application not found'
      });
    }
    
    res.json({
      success: true,
      application
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'Failed to fetch application',
      error: error instanceof Error ? error.message : 'Unknown error occurred'
    });
  }
});

// Update application status (Admin only)
router.patch('/:id/status', authenticateToken, async (req: Request, res: Response) => {
  try {
    const { status } = req.body;
    const application = await FranchiseApplication.findByIdAndUpdate(
      req.params.id,
      { 
        status,
        lastUpdated: new Date()
      },
      { new: true }
    );

    if (!application) {
      return res.status(404).json({
        success: false,
        message: 'Application not found'
      });
    }

    // TODO: Send email notification to applicant about status change

    res.json({
      success: true,
      message: 'Application status updated successfully',
      application
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'Failed to update application status',
      error: error instanceof Error ? error.message : 'Unknown error occurred'
    });
  }
});

// Add admin note to application (Admin only)
router.post('/:id/notes', authenticateToken, async (req: Request, res: Response) => {
  try {
    const { content } = req.body;
    const application = await FranchiseApplication.findByIdAndUpdate(
      req.params.id,
      {
        $push: {
          notes: {
            content,
            addedBy: 'Admin', // Assuming user info is added by auth middleware
            timestamp: new Date()
          }
        },
        lastUpdated: new Date()
      },
      { new: true }
    );

    if (!application) {
      return res.status(404).json({
        success: false,
        message: 'Application not found'
      });
    }

    res.json({
      success: true,
      message: 'Note added successfully',
      application
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'Failed to add note',
      error: error instanceof Error ? error.message : 'Unknown error occurred'
    });
  }
});

// Update admin management details (Admin only)
router.patch('/:id/admin-management', authenticateToken, async (req: Request, res: Response) => {
  try {
    const {
      cityManager,
      storeInspector,
      franchiseModel,
      loanRequired,
      numberOfFranchises,
      currentStatus
    } = req.body;

    const application = await FranchiseApplication.findByIdAndUpdate(
      req.params.id,
      {
        $set: {
          'adminManagement.cityManager': cityManager,
          'adminManagement.storeInspector': storeInspector,
          'adminManagement.franchiseModel': franchiseModel,
          'adminManagement.loanRequired': loanRequired,
          'adminManagement.numberOfFranchises': numberOfFranchises,
          'adminManagement.currentStatus': currentStatus,
          'adminManagement.lastUpdatedBy': 'Admin',
          'adminManagement.lastUpdatedAt': new Date()
        },
        lastUpdated: new Date()
      },
      { new: true }
    );

    if (!application) {
      return res.status(404).json({
        success: false,
        message: 'Application not found'
      });
    }

    res.json({
      success: true,
      message: 'Admin management details updated successfully',
      application
    });
  } catch (error) {
    console.error('Admin management update error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to update admin management details',
      error: error instanceof Error ? error.message : 'Unknown error occurred'
    });
  }
});

// Get admin management details (Admin only)
router.get('/:id/admin-management', authenticateToken, async (req: Request, res: Response) => {
  try {
    const application = await FranchiseApplication.findById(req.params.id)
      .select('adminManagement');

    if (!application) {
      return res.status(404).json({
        success: false,
        message: 'Application not found'
      });
    }

    res.json({
      success: true,
      adminManagement: application.adminManagement
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'Failed to fetch admin management details',
      error: error instanceof Error ? error.message : 'Unknown error occurred'
    });
  }
});

// Bulk update admin management details (Admin only)
router.patch('/bulk/admin-management', authenticateToken, async (req: Request, res: Response) => {
  try {
    const { applications } = req.body;
    
    if (!Array.isArray(applications)) {
      return res.status(400).json({
        success: false,
        message: 'Invalid request format'
      });
    }

    const updates = await Promise.all(
      applications.map(async ({ id, ...updateData }) => {
        const updated = await FranchiseApplication.findByIdAndUpdate(
          id,
          {
            $set: {
              'adminManagement': {
                ...updateData,
                lastUpdatedBy: 'Admin',
                lastUpdatedAt: new Date()
              }
            },
            lastUpdated: new Date()
          },
          { new: true }
        );
        return updated;
      })
    );

    res.json({
      success: true,
      message: 'Bulk update successful',
      updatedApplications: updates.filter(Boolean)
    });
  } catch (error) {
    console.error('Bulk update error:', error);
    res.status(500).json({
      success: false,
      message: 'Failed to perform bulk update',
      error: error instanceof Error ? error.message : 'Unknown error occurred'
    });
  }
});

// Delete application (Admin only)
router.delete('/:id', authenticateToken, async (req: Request, res: Response) => {
  try {
    const application = await FranchiseApplication.findByIdAndDelete(req.params.id);
    if (!application) {
      return res.status(404).json({ success: false, message: 'Application not found' });
    }

    res.json({ success: true, message: 'Application deleted successfully' });
  } catch (error) {
    console.error('Failed to delete application:', error);
    res.status(500).json({ success: false, message: 'Failed to delete application', error: error instanceof Error ? error.message : 'Unknown error' });
  }
});

export default router;